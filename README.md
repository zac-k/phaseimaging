# phaseimaging

## Introduction
This library provides a variety of functions related to phase imaging. Some of the included functions can be used to process experimental images, but I have also included functions to simulate these images. For experimental data, pre-processing will be required for meaningful results. In the future, I will add image registration and other preprocessing functions to enable perfoming all steps after image acquisition using only this library.

Note that although I have coded most of the functions to allow for rectangular images and specimen arrays, most of my testing has used square and cubic arrays, so there is a potential for bugs if you are using rectangular arrays. Please let me know if you experience any issues with any of the functions.

## Functions
### import_specimen
Generates a 3D numpy array from a specimen file. Input format is a text file (sans the file extension) with each block of rows/columns representing a 2D slice of the binary specimen mask. Each block is separated by an empty line. Specimen files can be generated using my [random-specimen-generator](github.com/zac-k/random-specimen-generator) repository. One specimen file is included in the present repository as an example.

  
| Parameters: | **specimen_file**:*string* |  |
|-------------|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  |  | Path of specimen file |
| Returns: | **specimen**:*ndarray* |  |
|  |  | Three-dimensional binary specimen mask. A value of `1` indicates a voxel where the specimen exists, and a value of `0` indicates a voxel where it does not. |
|  |  |  |
Note: Does not yet support rectangular (non-cubic) arrays.
### project_electrostatic_phase

Generates a phase map by projecting the electrostatic potential of the specimen in the z-direction.

| Parameters: | **specimen**:*array_like* |  |
|-------------|------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
|  |  | Three-dimensional binary specimen mask. |
|  | **accel_volt**:*float* |  |
|  |  | Electron accelerating voltage in volts. |
|  | **mean_inner_potential**:*complex float* |  |
|  |  | Constant mean inner electrostatic potential of the specimen. An imaginary component can be added for simulation of absorption. |
|  | **image_width**:*tuple*, *list* |  |
|  |  | Three element tuple or list containing the width of the specimen array in metres, in the x-, y-, and z-direction, respectively. |
| Returns: | **phase**:*ndarray* |  |
|  |  | Real, two-dimensional numpy array. The computed phase map. |

### project_magnetic_phase

Generate a phase map by projecting the magnetic vector potential of the specimen in the z-direction.

| Parameters: | **specimen**:*array_like* |  |
|-------------|----------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  |  | Three-dimensional binary specimen mask. |
|  | **mhat**:*tuple*, *list* |  |
|  |  | Magnetisation direction. A vector pointing in the direction of uniform magnetisation of the specimen. The length of this vector has no effect. It is advisable to use a unit vector for clarity. |
|  | **magnetisation**:*float* |  |
|  |  | Magnitude of the uniform magnetisation in A/m. |
|  | **image_width**:*tuple*, *list* |  |
|  |  | Three element tuple or list containing the width of the specimen array in metres, in the x-, y-, and z-direction, respectively. |
|  | **k_kernel**:*ndarray*, *optional* |  |
|  |  | Kernel of k-space vectors at z = 0. This can be saved from previous calculations provided that the size and resolution are the same. If this parameter is omitted, it will be generated by this function. |
|  | **inverse_k_squared_kernel**:*ndarray*, *optional* |  |
|  |  | Regularised inverse k^2 array. This can be saved from previous calculations provided that the size and resolution are the same. If this parameter is omitted, it will be generated by this function using the default regularisation parameter. |
| Returns: | **phase**:*ndarray* |  |
|  |  | Real, two-dimensional numpy array. The computed phase map. |